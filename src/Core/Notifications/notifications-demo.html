<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TMT CRM – Core/Notifications Demo</title>
  <style>
    :root{ --primary:#ffc300; --bg:#111; --panel:#1b1b1b; --muted:#777; --text:#f5f5f5; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --border:#2a2a2a; --card:#141414; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:var(--bg);}
    .topbar{position:sticky; top:0; z-index:50; display:flex; align-items:center; justify-content:space-between; padding:10px 16px; background:#000; border-bottom:1px solid var(--border);}
    .brand{display:flex; align-items:center; gap:10px; color:var(--text); font-weight:700}
    .brand .dot{width:10px; height:10px; background:var(--primary); border-radius:50%}
    .top-actions{display:flex; align-items:center; gap:12px}
    .bell{position:relative}
    .icon-btn{width:36px; height:36px; display:grid; place-items:center; border:1px solid var(--border); border-radius:10px; background:var(--card); cursor:pointer; transition:transform .08s ease;}
    .icon-btn:active{transform:scale(.98)}
    .badge{position:absolute; top:-4px; right:-4px; background:var(--primary); color:#111; font-weight:800; font-size:11px; line-height:1; padding:4px 6px; border-radius:999px; border:2px solid #000;}
    .panel{position:absolute; right:0; margin-top:8px; width:380px; max-width:calc(100vw - 16px); background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35); display:none; overflow:hidden;}
    .panel.open{display:block}
    .panel-header{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--border)}
    .panel-header h4{margin:0; font-size:14px}
    .panel-actions{display:flex; gap:8px}
    .panel-actions .mini{font-size:12px; color:var(--muted); cursor:pointer}
    .panel-actions .mini:hover{color:var(--text)}
    .list{max-height:360px; overflow:auto}
    .item{display:grid; grid-template-columns:auto 1fr auto; gap:10px; padding:12px; border-bottom:1px solid var(--border); background:transparent}
    .item:hover{background:#0e0e0e}
    .item:last-child{border-bottom:none}
    .circle{width:10px; height:10px; border-radius:50%}
    .circle.ok{background:var(--ok)} .circle.warn{background:var(--warn)} .circle.err{background:var(--err)}
    .item .title{font-weight:600;} .item .meta{color:var(--muted); font-size:12px; margin-top:2px}
    .item .actions{display:flex; gap:8px}
    .pill{border:1px solid var(--border); padding:6px 8px; border-radius:999px; color:var(--text); text-decoration:none; font-size:12px}
    .pill.primary{border-color:var(--primary);}
    .notice{margin:16px; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:#0f0f0f; display:flex; align-items:center; gap:10px}
    .notice .marker{width:8px; height:100%; background:var(--primary); border-radius:6px}
    .notice strong{color:var(--primary)}
    .container{max-width:1100px; margin:20px auto; padding:0 16px}
    .grid{display:grid; grid-template-columns: 1fr 320px; gap:16px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden}
    .card .card-hd{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
    .card .card-bd{padding:14px}
    .filters{display:flex; gap:10px; flex-wrap:wrap}
    .input, .select{background:#0d0d0d; border:1px solid var(--border); color:var(--text); padding:8px 10px; border-radius:10px}
    .btn{background:var(--primary); color:#111; border:none; padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer}
    .toast-wrap{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:10px; z-index:60}
    .toast{background:var(--panel); border:1px solid var(--border); border-left:6px solid var(--primary); border-radius:12px; padding:12px 14px; min-width:280px; box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .toast .t-title{font-weight:700} .toast .t-meta{color:var(--muted); font-size:12px}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand"><span class="dot"></span> TMT CRM – Notifications (Demo)</div>
    <div class="top-actions">
      <div class="bell">
        <button class="icon-btn" id="btnBell" aria-haspopup="true" aria-expanded="false" title="Thông báo">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 8a6 6 0 1 1 12 0c0 7 3 5 3 9H3c0-4 3-2 3-9"/><path d="M10.3 21a1.7 1.7 0 0 0 3.4 0"/></svg>
        </button>
        <span class="badge" id="badge">3</span>
        <div class="panel" id="panel">
          <div class="panel-header">
            <h4>Thông báo gần đây</h4>
            <div class="panel-actions">
              <span class="mini" id="markAll">Đánh dấu đã đọc</span>
              <span class="mini" id="openCenter">Mở trung tâm</span>
            </div>
          </div>
          <div class="list" id="listPanel"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="notice" role="status" aria-live="polite">
    <div class="marker"></div>
    <div>
      <div><strong>Thao tác thành công:</strong> Đã tạo công ty <b>Acme JSC</b>.</div>
      <div class="meta" style="color:var(--muted)">Chỉ bạn nhìn thấy thông báo này. Những người khác sẽ thấy trong Trung tâm thông báo (khi refresh/polling).</div>
    </div>
  </div>

  <div class="container">
    <div class="grid">
      <div class="card">
        <div class="card-hd">
          <div style="font-weight:700">Trung tâm thông báo</div>
          <div class="filters">
            <select class="select" id="fChannel">
              <option value="">Tất cả kênh</option>
              <option value="notice">Admin Notice</option>
              <option value="email">Email</option>
              <option value="webhook">Webhook</option>
            </select>
            <select class="select" id="fStatus">
              <option value="">Tất cả trạng thái</option>
              <option value="unread">Chưa đọc</option>
              <option value="read">Đã đọc</option>
              <option value="failed">Lỗi</option>
            </select>
            <select class="select" id="fEvent">
              <option value="">Tất cả sự kiện</option>
              <option value="CompanyCreated">CompanyCreated</option>
              <option value="CompanySoftDeleted">CompanySoftDeleted</option>
              <option value="QuoteSent">QuoteSent</option>
            </select>
            <button class="btn" id="btnApply">Lọc</button>
          </div>
        </div>
        <div class="card-bd"><div id="centerList"></div></div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div style="font-weight:700">Tóm tắt</div>
          <button class="btn" id="btnSimulate">Giả lập thông báo mới</button>
        </div>
        <div class="card-bd">
          <div id="stats">Đang tải…</div>
          <hr style="border-color:var(--border); opacity:.4">
          <p style="color:var(--muted)">Gợi ý: Polling mỗi 30–60s ở thực tế. Ở demo này bấm nút để tạo thông báo mới.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="toast-wrap" id="toasts"></div>

<script>
let seq = 1000;
const sample = () => ({ id: ++seq, event: 'CompanyCreated', channel: 'notice', status: 'unread',
  title: `Công ty mới được tạo #${seq}`, message: `User A vừa tạo công ty Demo #${seq}.`,
  entity: { type:'company', id: seq, name:`Demo Co. #${seq}` }, url: '#', created_at: new Date().toLocaleString('vi-VN') });

let notifications = [
  {id:1,event:'CompanyCreated',channel:'notice',status:'unread',title:'Tạo công ty Acme JSC',message:'User A đã tạo công ty Acme JSC.',entity:{type:'company',id:123,name:'Acme JSC'},url:'#',created_at:'18/09/2025 10:20:12'},
  {id:2,event:'QuoteSent',channel:'email',status:'read',title:'Đã gửi báo giá #Q-2025-0001',message:'Gửi cho khách hàng ACME.',entity:{type:'quote',id:1,name:'Q-2025-0001'},url:'#',created_at:'18/09/2025 10:22:40'},
  {id:3,event:'CompanySoftDeleted',channel:'notice',status:'unread',title:'Xoá mềm Công ty Beta Ltd',message:'User B đã xoá mềm Beta Ltd.',entity:{type:'company',id:124,name:'Beta Ltd'},url:'#',created_at:'18/09/2025 11:02:03'}
];

const $ = s=>document.querySelector(s);
function renderPanel(){ const list = $('#listPanel'); list.innerHTML = notifications.slice(0,10).map(panelItem).join(''); updateBadge(); }
function panelItem(n){ const state = n.status==='unread'?'warn':(n.status==='failed'?'err':'ok');
  return `<div class="item" data-id="${n.id}">
    <div class="circle ${state}"></div>
    <div><div class="title">${escapeHtml(n.title)}</div><div class="meta">${escapeHtml(n.created_at)} • ${escapeHtml(n.event)}</div></div>
    <div class="actions"><a class="pill" href="${n.url}">Xem</a><button class="pill primary" onclick="markRead(${n.id})">Đã đọc</button></div>
  </div>`;}
function renderCenter(){ const el = $('#centerList'); const ch = $('#fChannel').value, st = $('#fStatus').value, ev = $('#fEvent').value;
  let data = notifications.slice(); if(ch) data = data.filter(n=>n.channel===ch); if(st) data = data.filter(n=>n.status===st); if(ev) data = data.filter(n=>n.event===ev);
  el.innerHTML = data.map(centerRow).join(''); $('#stats').textContent = `Tổng: ${notifications.length} • Chưa đọc: ${notifications.filter(x=>x.status==='unread').length}`; }
function centerRow(n){ const state = n.status==='unread'?'warn':(n.status==='failed'?'err':'ok');
  return `<div class="item" data-id="${n.id}">
    <div class="circle ${state}"></div>
    <div>
      <div class="title">${escapeHtml(n.title)}</div>
      <div class="meta">${escapeHtml(n.created_at)} • ${escapeHtml(n.event)} • Kênh: ${n.channel}</div>
      <div class="meta">${escapeHtml(n.message)}</div>
    </div>
    <div class="actions"><a class="pill" href="${n.url}">Mở</a>${n.status==='unread'?`<button class="pill primary" onclick="markRead(${n.id})">Đánh dấu đã đọc</button>`:''}</div>
  </div>`;}
function updateBadge(){ const unread = notifications.filter(n=>n.status==='unread').length; const badge = $('#badge'); badge.textContent = unread; badge.style.display = unread? 'inline-block':'none'; }
function markRead(id){ const n = notifications.find(x=>x.id===id); if(n){ n.status='read'; renderPanel(); renderCenter(); } }
function markAll(){ notifications.forEach(n=> n.status='read'); renderPanel(); renderCenter(); }
function toast(title, meta){ const t = document.createElement('div'); t.className='toast'; t.innerHTML = `<div class="t-title">${escapeHtml(title)}</div><div class="t-meta">${escapeHtml(meta||'')}</div>`; $('#toasts').appendChild(t);
  setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateY(10px)'; }, 3500); setTimeout(()=>{ t.remove(); }, 4100); }
function escapeHtml(str){ return String(str).replace(/[&<>"]+/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[s])); }
$('#btnBell').addEventListener('click', ()=>{ const p = $('#panel'); const opened = p.classList.toggle('open'); document.getElementById('btnBell').setAttribute('aria-expanded', opened? 'true':'false'); });
document.getElementById('openCenter').addEventListener('click', ()=>{ document.getElementById('panel').classList.remove('open'); window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'}); });
document.getElementById('markAll').addEventListener('click', markAll);
document.getElementById('btnApply').addEventListener('click', renderCenter);
document.getElementById('btnSimulate').addEventListener('click', ()=>{ const n = sample(); notifications.unshift(n); renderPanel(); renderCenter(); toast('Có thông báo mới', n.title); });
renderPanel(); renderCenter();
</script>
</body>
</html>
