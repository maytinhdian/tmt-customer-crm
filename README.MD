# === Tree tá»•ng quan (plugin: tmt-customer-crm) ===
# Gá»£i Ã½ Ä‘áº·t trong wp-content/plugins/tmt-customer-crm

.
â”œâ”€ tmt-customer-crm.php                # Bootstrap plugin chÃ­nh
â”œâ”€ composer.json                       # PSR-4 autoload cho src/
â”œâ”€ package.json                        # build assets (náº¿u cáº§n)
â”œâ”€ phpcs.xml                           # coding standard
â”œâ”€ README.md
â”œâ”€ .gitignore
â”œâ”€ assets/
â”‚  â”œâ”€ css/
â”‚  â”‚  â””â”€ admin.css
â”‚  â”œâ”€ js/
â”‚  â”‚  â”œâ”€ admin.js
â”‚  â”‚  â””â”€ api-client.js
â”‚  â””â”€ scss/
â”‚     â””â”€ admin.scss
â”œâ”€ languages/
â”‚  â””â”€ tmt-customer-crm-vi_VN.po
â”œâ”€ templates/                          # View cho Admin/Page/Email
â”‚  â”œâ”€ admin/
â”‚  â”‚  â”œâ”€ customers-list.php
â”‚  â”‚  â”œâ”€ customer-edit.php
â”‚  â”‚  â””â”€ dashboard.php
â”‚  â”œâ”€ emails/
â”‚  â”‚  â””â”€ reminder-debt.php
â”‚  â””â”€ public/
â”‚     â””â”€ shortcode-customer-profile.php
â”œâ”€ src/                                # Code OOP chia theo táº§ng
â”‚  â”œâ”€ Application/                     # Services (use-case level)
â”‚  â”‚  â”œâ”€ Services/
â”‚  â”‚  â”‚  â”œâ”€ customer-service.php
â”‚  â”‚  â”‚  â”œâ”€ company-service.php
â”‚  â”‚  â”‚  â”œâ”€ quotation-service.php
â”‚  â”‚  â”‚  â”œâ”€ invoice-service.php
â”‚  â”‚  â”‚  â””â”€ debt-service.php
â”‚  â”‚  â””â”€ DTO/
â”‚  â”‚     â”œâ”€ customer-dto.php
â”‚  â”‚     â”œâ”€ company-dto.php
â”‚  â”‚     â”œâ”€ quotation-dto.php
â”‚  â”‚     â”œâ”€ invoice-dto.php
â”‚  â”‚     â””â”€ payment-dto.php
â”‚  â”œâ”€ Domain/                          # Entities + Interfaces
â”‚  â”‚  â”œâ”€ Entities/
â”‚  â”‚  â”‚  â”œâ”€ customer.php
â”‚  â”‚  â”‚  â”œâ”€ company.php
â”‚  â”‚  â”‚  â”œâ”€ quotation.php
â”‚  â”‚  â”‚  â”œâ”€ invoice.php
â”‚  â”‚  â”‚  â””â”€ debt.php
â”‚  â”‚  â””â”€ Repositories/
â”‚  â”‚     â”œâ”€ customer-repository-interface.php
â”‚  â”‚     â”œâ”€ company-repository-interface.php
â”‚  â”‚     â”œâ”€ quotation-repository-interface.php
â”‚  â”‚     â”œâ”€ invoice-repository-interface.php
â”‚  â”‚     â””â”€ debt-repository-interface.php
â”‚  â”œâ”€ Infrastructure/                   # Triá»ƒn khai cá»¥ thá»ƒ (wpdb)
â”‚  â”‚  â”œâ”€ Persistence/
â”‚  â”‚  â”‚  â”œâ”€ wpdb-customer-repository.php
â”‚  â”‚  â”‚  â”œâ”€ wpdb-company-repository.php
â”‚  â”‚  â”‚  â”œâ”€ wpdb-quotation-repository.php
â”‚  â”‚  â”‚  â”œâ”€ wpdb-invoice-repository.php
â”‚  â”‚  â”‚  â””â”€ wpdb-debt-repository.php
â”‚  â”‚  â”œâ”€ Migrations/
â”‚  â”‚  â”‚  â””â”€ installer.php              # Táº¡o/Update báº£ng
â”‚  â”‚  â””â”€ Integration/
â”‚  â”‚     â”œâ”€ woocommerce-sync.php
â”‚  â”‚     â””â”€ email-sender.php
â”‚  â”œâ”€ Presentation/                     # Giao diá»‡n + REST + Admin
â”‚  â”‚  â”œâ”€ Admin/
â”‚  â”‚  â”‚  â”œâ”€ menu.php
â”‚  â”‚  â”‚  â”œâ”€ customers-screen.php
â”‚  â”‚  â”‚  â”œâ”€ customer-edit-screen.php
â”‚  â”‚  â”‚  â””â”€ dashboard-screen.php
â”‚  â”‚  â”œâ”€ REST/
â”‚  â”‚  â”‚  â”œâ”€ routes.php
â”‚  â”‚  â”‚  â””â”€ customer-controller.php
â”‚  â”‚  â””â”€ Shortcodes/
â”‚  â”‚     â””â”€ customer-profile-shortcode.php
â”‚  â””â”€ Shared/
â”‚     â”œâ”€ container.php                 # Service Container nhá» gá»n
â”‚     â”œâ”€ hooks.php                     # ÄÄƒng kÃ½ action/filter
â”‚     â””â”€ utils.php
â””â”€ tests/
   â”œâ”€ unit/
   â””â”€ integration/

# Coding Guidelines â€“ TMT CRM

> Chuáº©n hoÃ¡ cho plugin **TMT Customer CRM** trÃªn WordPress (OOP + PSRâ€‘4).

## 1) Má»¥c Ä‘Ã­ch

* TrÃ¡nh lá»—i PSRâ€‘4/Composer *Skipping* khi autoload.
* Giá»¯ code thá»‘ng nháº¥t, dá»… báº£o trÃ¬, má»Ÿ rá»™ng.

## 2) Autoload & PSRâ€‘4

* Namespace gá»‘c: `TMT\CRM\` â†’ map vá»›i thÆ° má»¥c `src/`.
* Má»—i segment namespace = má»™t thÆ° má»¥c con (phÃ¢n biá»‡t HOA/thÆ°á»ng):

  * `TMT\CRM\Application\DTO\CompanyDto` â†” `src/Application/DTO/CompanyDto.php`.
  * `TMT\CRM\Infrastructure\Integration\WooCommerceSync` â†” `src/Infrastructure/Integration/WooCommerceSync.php`.
* **ClassName = FileName.php** (Ä‘Ãºng **case-sensitive**).
* KhÃ´ng dÃ¹ng kÃ½ tá»± `_` hoáº·c `-` trong tÃªn **class/file**.
* Sau khi thÃªm/sá»­a file: cháº¡y `composer dump-autoload -o`.

### composer.json (chuáº©n)

```json
{
  "autoload": {
    "psr-4": {
      "TMT\\CRM\\": "src/"
    }
  }
}
```

## 3) Quy táº¯c Ä‘áº·t tÃªn

* **DTO**: `SomethingDto`
  VÃ­ dá»¥: `CompanyDto`, `CustomerDto`.
* **Service**: `SomethingService`
  VÃ­ dá»¥: `InvoiceService`, `CustomerService`.
* **Entity**: Danh tá»« sá»‘ Ã­t, PascalCase
  VÃ­ dá»¥: `Company`, `Customer`, `Invoice`.
* **Repository**:
  Interface â†’ `SomethingRepositoryInterface`
  Implementation â†’ `DbSomethingRepository` hoáº·c `WpdbSomethingRepository`
* **Controller**: `SomethingController`
* **KhÃ¡c**: `Hooks`, `Status`, `Container`, `Routes`â€¦
* **ThÆ° má»¥c**: Ä‘Ãºng chÃ­nh táº£, PascalCase cho tá»« viáº¿t táº¯t (vÃ­ dá»¥: `Integration`, khÃ´ng pháº£i `Intergration`).

## 4) Quy táº¯c ghi chÃº **Ä‘á»‹a chá»‰ file** khi thÃªm/sá»­a code

* Má»i snippet pháº£i chÃº thÃ­ch **Ä‘Æ°á»ng dáº«n file** ngay phÃ­a trÃªn Ä‘oáº¡n code.
* KÃ½ hiá»‡u:

  * **ğŸ“„ Táº¡o file má»›i:** `src/Path/FileName.php`
  * **âœï¸ Sá»­a file:** `src/Path/FileName.php` *(thÃªm dÃ²ng â€¦ / thay tháº¿ block â€¦ náº¿u cáº§n)*

**VÃ­ dá»¥**

ğŸ“„ **Táº¡o file má»›i**: `src/Application/DTO/CustomerDto.php`

```php
<?php
namespace TMT\CRM\Application\DTO;

final class CustomerDto
{
    public function __construct(
        public string $name,
        public string $email,
        public string $phone
    ) {}
}
```

âœï¸ **Sá»­a file**: `src/Application/Services/CustomerService.php`

```php
// thÃªm phÆ°Æ¡ng thá»©c tÃ¬m theo email
public function findByEmail(string $email): ?CustomerDto
{
    // ...
}
```

## 5) Phong cÃ¡ch code (OOP)

* **Visibility** rÃµ rÃ ng: `public/protected/private`.
* **final** cho class/value object khi há»£p lÃ½; **interface** cho há»£p Ä‘á»“ng.
* **Type-hint** Ä‘áº§y Ä‘á»§ + **return type**.
* **DTO**: immutable (Æ°u tiÃªn property promotion), khÃ´ng chá»©a logic nghiá»‡p vá»¥.
* **Service**: chá»©a use-case; khÃ´ng truy cáº­p DB trá»±c tiáº¿p.
* **Repository**: chá»‹u trÃ¡ch nhiá»‡m truy xuáº¥t dá»¯ liá»‡u (WPDB/Meta/WC...).
* **Controller**: má»ng, gá»i Service/Repository; khÃ´ng nhÃºng SQL.

## 6) Hook timing & Bootstrap

* File plugin chÃ­nh **require** `vendor/autoload.php` trÆ°á»›c.
* Khá»Ÿi Ä‘á»™ng qua `add_action('plugins_loaded', ...)`.
* TrÃ¡nh gá»i WooCommerce API trÆ°á»›c `plugins_loaded`.
* `register_activation_hook` chá»‰ kiá»ƒm tra yÃªu cáº§u tá»‘i thiá»ƒu + thiáº¿t láº­p nháº¹.

## 7) Quy trÃ¬nh thÃªm file má»›i

1. Táº¡o class vá»›i **tÃªn chuáº©n** (PascalCase).
2. Äáº·t vÃ o **Ä‘Ãºng thÆ° má»¥c** theo namespace.
3. Cháº¡y `composer dump-autoload -o`.
4. Viáº¿t test/usage tá»‘i thiá»ƒu hoáº·c admin notice kiá»ƒm tra náº¡p hook.
5. Commit theo template (dÆ°á»›i Ä‘Ã¢y).

## 8) Checklist trÆ°á»›c commit

* [ ] Class = FileName.php (Ä‘Ãºng hoa/thÆ°á»ng).
* [ ] KhÃ´ng cÃ³ `-` hoáº·c `_` trong tÃªn class/file.
* [ ] ÄÆ°á»ng dáº«n thÆ° má»¥c khá»›p namespace (bao gá»“m chÃ­nh táº£ `Integration`, `Persistence`, â€¦).
* [ ] `composer dump-autoload -o` cháº¡y **khÃ´ng cÃ²n** â€œdoes not comply / Skippingâ€.

## 9) Máº«u commit message

```
feat(dto): add CustomerDto and CompanyDto

- Create src/Application/DTO/CustomerDto.php
- Create src/Application/DTO/CompanyDto.php
- Wire up Services to use new DTOs
```

```
refactor(repository): rename WPDB_* to Wpdb* (PSR-4 compliance)

- Rename src/Infrastructure/Persistence/wpdb-customer-repository.php -> WpdbCustomerRepository.php
- Update namespace imports and type hints
- Run composer dump-autoload -o
```

---

**LÆ°u Ã½:** náº¿u rename hÃ ng loáº¡t, Æ°u tiÃªn `CompanyDTO -> CompanyDto`, `WPDB_* -> Wpdb*` Ä‘á»ƒ thá»‘ng nháº¥t PascalCase.
